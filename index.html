<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Registrace vstupenek</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; padding: 1rem; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select, button { width: 100%; padding: 8px; margin-top: 4px; }
    #qr { text-align: center; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Registrace vstupenek</h1>
  <form id="ticketForm">
    <label>Jméno a příjmení:</label>
    <input type="text" name="name" required>

    <label>Stav:</label>
    <select name="status">
      <option value="nezaplaceno">Nezaplaceno</option>
      <option value="zaplaceno">Zaplaceno</option>
    </select>

    <label>Stání (300 Kč):</label>
    <input type="number" name="stani" min="0" value="0">

    <label>Sezení (350 Kč):</label>
    <input type="number" name="sezeni" min="0" value="0">

    <label>After party (150 Kč):</label>
    <input type="number" name="afterparty" min="0" value="0">

    <button type="submit">Odeslat</button>
  </form>

  <div id="result"></div>
  <div id="qr"></div>

  <script>
    const FORM = document.getElementById('ticketForm');
    FORM.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = {
        name: FORM.name.value,
        status: FORM.status.value,
        tickets: {
          "stání": FORM.stani.value,
          "sezení": FORM.sezeni.value,
          "after party": FORM.afterparty.value
        }
      };

      const response = await fetch("https://script.google.com/macros/s/AKfycbwSQJWJxhOsHgvd8wP251Y-oXgkCFswLz3VK5FFx6dYhirCHkwzfFX3avdhPKWVXjVk3Q/exec", {
        method: "POST",
        contentType: "application/json",
        body: JSON.stringify(data)
      });
      const res = await response.json();

      document.getElementById('result').innerHTML = `
        <h3>✅ Úspěšně odesláno!</h3>
        <p><strong>ID:</strong> ${res.id}</p>
        <p><strong>Email:</strong> ${res.email}</p>
        <p><strong>Celková cena:</strong> ${res.total} Kč</p>
      `;

      // QR kód
      const qrDiv = document.getElementById('qr');
      qrDiv.innerHTML = "";
      new QRCode(qrDiv, res.paymentQR);
    });
  </script>
</body>
</html>
