<script>
const FORM = document.getElementById('ticketForm');

FORM.addEventListener('submit', async (e) => {
  // Zabrání standardnímu odeslání (GET a reload stránky)
  e.preventDefault();

  // Získání hodnot z formuláře
  const name = FORM.name.value.trim();
  const status = FORM.status.value;
  const tickets = {
    "stání": parseInt(FORM.stani.value) || 0,
    "sezení": parseInt(FORM.sezeni.value) || 0,
    "after party": parseInt(FORM.afterparty.value) || 0
  };

  // Výpočet ceny
  const PRICES = { "stání": 300, "sezení": 350, "after party": 150 };
  let total = 0;
  let ticketText = [];
  for (let type in tickets) {
    if (tickets[type] > 0) {
      total += tickets[type] * PRICES[type];
      ticketText.push(`${tickets[type]}x ${type}`);
    }
  }

  // Zobrazení souhrnu
  document.getElementById('result').innerHTML = `
    <h3>✅ Úspěšně vyplněno!</h3>
    <p><strong>Jméno:</strong> ${name}</p>
    <p><strong>Stav:</strong> ${status}</p>
    <p><strong>Vstupenky:</strong> ${ticketText.join(', ')}</p>
    <p><strong>Celková cena:</strong> ${total} Kč</p>
  `;

  // QR kód
  const qrDiv = document.getElementById('qr');
  qrDiv.innerHTML = "";
  new QRCode(qrDiv, `${total} Kč – ${name}`);

  // Odeslání do Google Sheets
  fetch("https://script.google.com/macros/s/AKfycbyucqiP6rIpd6QynhHaj6P3sNwV_tSB_bZCavmlEIfDsuybtGDzdYH7y-7KqlV2sxeupQ/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, status, tickets })
  })
  .then(() => console.log("Data odeslána"))
  .catch(err => console.error("Chyba při odeslání:", err));
});
</script>
